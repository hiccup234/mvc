
## 幂等性接口

数学上的定义：f(f(x))=f(x)，即x被函数f作用一次和作用无限次的结果是一样的。

幂等性应用在软件系统中，可以把它简单定义为：某个函数或者某个接口使用相同参数调用一次或者无限次，其造成的后果是一致的。

幂等需要通过唯一的业务单号来保证，也就是说相同的业务单号，才能认为是同一笔业务。

### 解决方案

   * 乐观锁：通过数据库的乐观锁（数据行+version字段）

   * 防重表：用业务单号orderNo做为去重表的唯一索引，每次请求都向去重表中插入数据，
           如果失败则证明有竞争条件存在，需要查询其他请求是否执行成功，成功则返回，失败则再次重试
           去重表的主要作用就是加锁（会不会受到事务隔离级别的影响？插入会造成当前读所以不会有影响）。
           
   * 分布式锁：分布式系统中，不能再依靠DBMS的锁（生成自增主键的时候应该有一把锁，或者说是cas的AtomicInteger）
           可以利用Redis的setnx，把业务单号作为key，如果失败则证明已经处理过了。
   
   * 请求缓冲区：用阻塞队列来接收所有的请求，相当于把并发的请求转换为串行的了，类比Redis的单I/O线程。
   
   
   