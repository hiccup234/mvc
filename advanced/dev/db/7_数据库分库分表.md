
# 数据库数据量太大优化

## 垂直拆分
    将原本的单体库按业务模块拆分成订单库，用户库等，从数据库层面分散访问压力。
    
## 水平拆分
    如果垂直拆分后，某些业务单库数据量还是太大，如订单表达到数千万级别（MySQL推荐单表存储量在百万级别）
    则考虑水平拆分为多张表，也可结合分库来做，分库分表中最重要的就是路由策略。
    
### hash取模
    类似缓存的hash取模，但是数据库hash分片扩容时必定涉及数据迁移
    
   * 优点：数据可以均匀的放在每张分片表中，不会有热点问题
   * 缺点：将来扩容时需要做数据迁移，比较麻烦

### range范围
    按范围来做分片，0-1000W放表1，1000W-2000W放表2，依此类推
   
   * 优点：方便扩容，不需要做数据迁移
   * 缺点：会有热点问题，一般id都是自增长，会导致最近一张分片表压力过大

### group分组（结合hash和range）
    先按id范围做大的分组，如0-5000W是group0，5000W-10000W是group1，依此类推
    再在组内按hash取模做分表路由，扩容时是直接扩一个group，所以已有的group不用做迁移
    在group里还可以做分库和分表，跟据id来hash到不同的库，到库后也可再按range分表
    

### 面临的问题
    事务问题，在应用层考虑事务，数据库自带的事务已经无法满足（分布式事务）
    跨节点join问题
    跨节点的count、order by、group by的聚合操作问题
  
  
### 优化和思考    
    能不分则尽量不分：mysql单库可以支撑5000W左右的数据量，需要结合业务的增长情况具体考虑。

    MySQL内部提供了分区表的特性

    冷热数据分离，把历史数据，老数据归档（参考电商网站的订单记录：查最近3个月，最近1年，最近3年等）

    考虑其他的数据存储方式（ES，HBASE等）
    
    
    