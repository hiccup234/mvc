
# 接口限流算法

## 计数器与滑动窗口算法

    固定时间窗口：比如每秒钟限制2000的QPS，通过计数来确定剩余容量，满一秒钟后重置计数器为0。
    缺点：限流策略过于粗糙，无法应对两个时间窗口临界时间内的突发流量，即最小时间单位任然可能爆发非常高的流量，
         比如第一秒的最后10ms才来2000QPS，而第二秒前10ms也来了2000QPS，则系统在20ms内就要承受4000QPS，很容易压垮系统。
         
    滑动时间窗口：可以看作一个循环队列，请求进来后都入队，入队时直接删除队头超过1秒的请求，再看队列是否空闲，
        如果仍没有空闲则说明这1秒的QPS超过了阈值，需要拒绝当前请求。
    缺点：可以解决上诉时间边界问题，但仍然无法解决一秒钟内某个时间段高并发的流量冲击，只能划分更小粒度，但会导致浪费更多的存储空间。

## 漏斗算法
    漏斗的最大出水速率是恒定的，那么意味着如果瞬时大流量的话，将有大部分请求被丢弃掉（也就是所谓的溢出），而如果某时刻下游服务比较空闲也无法获得更多的请求。

## 令牌桶算法
    生成令牌的速度是恒定的，而请求去拿令牌是没有速度限制的。
    这意味，面对瞬时大流量，该算法可以在短时间内请求拿到大量令牌，而且拿令牌的过程并不是消耗很大的事情。


服务治理：鉴权、限流、降级、熔断、监控告警

鉴权：
1、接口名精确匹配：先把接口规则排序，二分查找需要匹配的接口名，匹配算法可以采用KMP、BM、BF等，或者直接哈希表
2、接口名前缀匹配：利用Trie树来做前缀匹配
3、接口名模糊匹配：利用正则表达式匹配（回溯算法），比较耗时